#!/bin/sh
# the entry point of fzfaws

# current script directory
mydir="${0%/*}"

# help message
function usage() {
  echo "help"
}

# if no argument are passed, display all available commands and show their help
if [[ -z "$@" ]]; then
  echo 'No action command detected'
  echo "Below are the available supported commands"
  # display all scripts in src folder and show their help message
  action_command=$(find "$mydir"/src -type f -depth 1 | \
    awk -F '/' '{print $NF}' | \
    fzf --preview "$mydir/src/{} -h")
  [[ -z "$action_command" ]] && exit 0
  "$mydir/src/$action_command"
  exit 0
fi

# process the first argument and run appropriate script
action_command=''
case "$1" in
  s3)
    action_command='s3';;
  cform)
    action_command='cform';;
  pem)
    action_command='pem';;
  ec2)
    action_command='ec2';;
  help)
    usage
    exit 0;;
  -h)
    usage
    exit 0;;
  *)
    usage
    exit 1;;
esac
# clean/remove the first processed argument
shift

[[ -z "$action_command" ]] && exit 1

# run the script based on the first argument
# pass the rest of the argument to the new script
"$mydir/src/$action_command" "$@"
